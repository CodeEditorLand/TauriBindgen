import { default as Benchmark } from "benchmark";
const suite = new Benchmark.Suite();

function ser_varint(out, type, val) {
    let buf: number[] = []
    for (let i = 0; i < varint_max(type); i++) {
        const buffer = new ArrayBuffer(type / 8);
        const view = new DataView(buffer);
        view.setInt16(0, val, true);
        buf[i] = view.getUint8(0);
        if (val < 128) {
            out.push(...buf)
            return;
        }

        buf[i] |= 0x80;
        val >>= 7;
    }
    out.push(...buf)
}
function serializeU64(out, val) {
    return ser_varint(out, 64, val)
}
function serializeString(out, val) {
    serializeU64(out, val.length);

    out.push(...__text_encoder.encode(val))
}






class Serializer {
  bytes: Uint8Array;
  offset: number;

  constructor(len: number) {
    this.bytes = new Uint8Array(len);
    this.offset = 0;
  }

  push_u8(num: number) {
    this.bytes[this.offset] = num
    this.offset += 1
  }

  push(bytes: ArrayLike<number>) {
    this.bytes.set(bytes, this.offset);
    this.offset += bytes.length;
  }
}

function varint_max(type) {
  const BITS_PER_BYTE = 8;
  const BITS_PER_VARINT_BYTE = 7;

  const bits = type * BITS_PER_BYTE;

  const roundup_bits = bits + (BITS_PER_BYTE - 1);

  return Math.floor(roundup_bits / BITS_PER_VARINT_BYTE);
}

const varintMax = {
    16: 19,
    32: 37,
    64: 74
}

function serVarint2(ser: Serializer, bits: number, val: number) {
    for (let i = 0; i < varintMax[bits]; i++) {
        const buffer = new ArrayBuffer(bits / 8);
        const view = new DataView(buffer);
        view.setInt16(0, val, true);
        ser.push_u8(view.getUint8(0));
        if (val < 128) {
            return;
        }

        ser.bytes[ser.offset] |= 0x80;
        val >>= 7;
    }
}

const __text_encoder = new TextEncoder();

function serString2(ser: Serializer, val: string) {
    serVarint2(ser, 64, val.length)
    ser.push(__text_encoder.encode(val))
}

const data = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris faucibus ex ut tempus dictum. Cras in faucibus lectus. Nam nisi eros, sollicitudin eu lacus sollicitudin, luctus hendrerit justo. Aenean turpis leo, laoreet id bibendum a, vehicula ac augue. Integer quis pellentesque diam, ut dapibus urna. Fusce eget aliquet risus, a fermentum dolor. Donec magna diam, tempor et nulla id, convallis fermentum ligula. Cras quis sollicitudin neque. Maecenas nisl neque, luctus vitae turpis laoreet, venenatis condimentum augue. Duis luctus enim at dolor pulvinar egestas.Ut vel turpis imperdiet, suscipit justo id, pellentesque orci. Nullam quis euismod arcu. Praesent a sapien nec tellus sollicitudin porttitor. Etiam id ultrices magna, sit amet commodo est. Ut mollis venenatis dolor, in auctor ante fermentum vel. Maecenas vitae rhoncus odio. Vestibulum luctus velit eget venenatis suscipit. Aliquam leo lorem, consectetur at sapien sed, dignissim molestie arcu. Ut tincidunt odio elit, vel finibus elit suscipit vel. Vivamus tortor ipsum, iaculis eget scelerisque sit amet, pellentesque eget enim. Aenean varius enim dolor, vitae pretium purus molestie non.Curabitur sed lorem ac ante pretium venenatis. Praesent volutpat non libero ac tristique. Nulla eleifend urna quis dapibus volutpat. Aliquam vel varius elit, eu placerat arcu. Nam porta dictum lectus et ullamcorper. Proin fringilla odio elit, ac mattis nisl luctus non. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Sed porttitor gravida libero eget iaculis. Sed eleifend nisl nec diam ornare, at aliquet mauris viverra. Nullam a diam imperdiet, placerat ipsum in, placerat urna. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;Phasellus mi velit, pretium a eleifend non, blandit non velit. Vestibulum ac porttitor tortor, maximus imperdiet orci. Nunc a rhoncus arcu. Cras pretium dolor eget pellentesque dapibus. Maecenas sed neque molestie, rutrum nisl eget, commodo erat. Vivamus id turpis in arcu lobortis dapibus non a enim. Mauris sit amet feugiat nibh. Pellentesque iaculis sodales sapien, at ultrices mauris bibendum in. Curabitur non facilisis risus, eu rhoncus tellus. Ut ultricies eros eget consectetur eleifend.Integer porta eros in luctus fringilla. Ut sagittis gravida lectus, eget vulputate nibh rutrum sed. Suspendisse a ex consectetur, pellentesque orci non, vestibulum dui. Integer gravida at odio cursus maximus. Morbi eget nunc lorem. Phasellus commodo ante et aliquam commodo. Aliquam gravida, nibh id vulputate tincidunt, magna dui sollicitudin arcu, in laoreet enim ipsum vitae ex. Maecenas venenatis pellentesque purus. Nullam ac leo id urna rutrum cursus. Donec et mattis ex. Praesent faucibus sollicitudin feugiat. Pellentesque venenatis leo ex, sed mattis risus convallis eu. Pellentesque nec consequat arcu. Fusce malesuada nec ante a porttitor. Ut ut nulla id tortor aliquam egestas. Suspendisse mattis a tortor vitae convallis"

// add tests
suite
  .add("current", function () {
    const out = [];
    serializeString(out, data);
  })
  .add("current2", function () {
    // it's fine if we over allocate as long as we don't run out of space in the array
    const ser = new Serializer(data.length * 4 + 4)
    serString2(ser, data);
  })
  // add listeners
  .on("cycle", function (event) {
    console.log(String(event.target));
  })
  .on("complete", function () {
    console.log("Fastest is " + this.filter("fastest").map("name"));
  })
  // run async
  .run({ async: true });